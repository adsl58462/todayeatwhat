<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ä»Šå¤©åƒä»€éº¼ï¼ŸğŸ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: #fffbe6;
      color: #333;
    }
    h1 { text-align: center; margin-bottom: 30px; }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    .control-group {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    select, input[type=range], button {
      padding: 8px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #fff;
    }
    button {
      cursor: pointer;
      background: #ffd447;
      border: none;
      transition: background 0.3s;
    }
    button:hover {
      background: #ffc107;
    }

    .wheel-container {
      width: 300px;
      height: 300px;
      margin: 20px auto;
      position: relative;
    }
    .wheel {
      width: 100%; height: 100%;
      border-radius: 50%;
      border: 10px solid #f7c948;
      background: conic-gradient(#ff9a9e 0% 25%, #fad0c4 25% 50%, #a1c4fd 50% 75%, #c2e9fb 75% 100%);
      transition: transform 5s ease-out;
    }
    .pointer {
      position: absolute; top: -30px; left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 30px solid red;
    }
    #map {
      width: 100%; height: 300px; margin-top: 20px;
      border-radius: 12px;
    }
    #result, #details {
      margin-top: 15px;
      font-size: 1.1rem;
      text-align: center;
    }

    @media (max-width: 600px) {
      .wheel-container {
        width: 200px;
        height: 200px;
      }
      #map {
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <h1>ä»Šå¤©åƒä»€éº¼ï¼ŸğŸœ</h1>

  <div class="controls">
    <div class="control-group">
      <label>é¤é»é¡åˆ¥</label>
      <select id="category">
        <option value="æ—©é¤">æ—©é¤</option>
        <option value="åˆé¤">åˆé¤</option>
        <option value="æ™šé¤">æ™šé¤</option>
        <option value="å®µå¤œ">å®µå¤œ</option>
        <option value="å’–å•¡å»³">å’–å•¡å»³</option>
        <option value="é…’å§">é…’å§</option>
        <option value="é…’å§">é£²æ–™</option>
      </select>
    </div>

    <div class="control-group">
      <label>è·é›¢ (km)</label>
      <input type="range" id="distance" min="1" max="5" step="1" value="1">
      <span id="distanceValue">1</span>
    </div>

    <div class="control-group">
      <label>æœ€ä½æ˜Ÿç­‰</label>
      <select id="ratingFilter">
        <option value="0">ä¸é™</option>
        <option value="3.5">3.5â†‘</option>
        <option value="4.0"selected>4.0â†‘</option>
        <option value="4.5">4.5â†‘</option>
      </select>
    </div>

    <div class="control-group">
      <label>&nbsp;</label>
      <button onclick="findPlaces()">æœå°‹é™„è¿‘é¤å»³</button>
    </div>
  </div>

  <div class="wheel-container">
    <div class="wheel" id="wheel"></div>
  </div>
  <div style="text-align: center;">
    <button onclick="spin()">é–‹å§‹è½‰ç›¤ï¼</button>
  </div>

  <div id="result"></div>
  <div id="details"></div>
  <div id="map"></div>

  <script>
    const categoryInput = document.getElementById("category");
    const distanceInput = document.getElementById("distance");
    const distanceValue = document.getElementById("distanceValue");
    const ratingFilter = document.getElementById("ratingFilter");
    const resultDiv = document.getElementById("result");
    const detailDiv = document.getElementById("details");
    const wheel = document.getElementById("wheel");
    

    
    
    let map;
    let service;
    let currentLocation;
    let currentPlaces = [];
    let placeMarkers = [];
    let highlightMarker = null;
    let totalRotate = 0;


    distanceInput.addEventListener("input", () => {
    distanceValue.textContent = distanceInput.value;
    });

    categoryInput.addEventListener("change", findPlaces);
    ratingFilter.addEventListener("change", findPlaces);
    distanceInput.addEventListener("change", findPlaces);
    function initMap() {
      navigator.geolocation.getCurrentPosition(pos => {
        currentLocation = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        };
        map = new google.maps.Map(document.getElementById("map"), {
          center: currentLocation,
          zoom: 15
        });
        new google.maps.Marker({ position: currentLocation, map, title: "ä½ çš„ä½ç½®" });
      });
    }

    function clearMarkers() {
      placeMarkers.forEach(marker => marker.setMap(null));
      placeMarkers = [];
      if (highlightMarker) highlightMarker.setMap(null);
    }

    function findPlaces() {
      if (!currentLocation) return alert("ç„¡æ³•ç²å–å®šä½");
      clearMarkers();

      const keyword = categoryInput.value;
      const radius = parseInt(distanceInput.value) * 1000;
      const minRating = parseFloat(ratingFilter.value);

      const request = {
        location: currentLocation,
        radius: radius,
        keyword: keyword,
        openNow: true
      };

      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, (results, status) => {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          currentPlaces = results
            .filter(p => !minRating || (p.rating && p.rating >= minRating))
            .map(p => ({
              name: p.name,
              rating: p.rating || "ç„¡æ˜Ÿç­‰",
              address: p.vicinity || "åœ°å€ä¸è©³",
              location: p.geometry.location,
              place_id: p.place_id
            }));

          if (currentPlaces.length === 0) return alert("æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„åº—å®¶");
          showMarkers(currentPlaces);
          updateWheel();
        } else {
          alert("æœå°‹å¤±æ•—ï¼");
        }
      });
    }

    function showMarkers(places) {
      map.setCenter(currentLocation);
      places.forEach(place => {
        const marker = new google.maps.Marker({
          position: place.location,
          map,
          title: place.name
        });
        placeMarkers.push(marker);
      });
    }

    function updateWheel() {
      const colors = ['#fbc2eb', '#a6c1ee', '#fdcbf1', '#f3e5f5'];
      const num = currentPlaces.length;
      const slice = 100 / num;
      const gradientParts = currentPlaces.map((_, i) =>
        `${colors[i % colors.length]} ${i * slice}% ${(i + 1) * slice}%`
      );
      wheel.style.background = `conic-gradient(${gradientParts.join(",")})`;
    }

    function spin() {
      if (currentPlaces.length === 0) return alert("è«‹å…ˆæœå°‹é¤å»³");
      const anglePer = 360 / currentPlaces.length;
      const index = Math.floor(Math.random() * currentPlaces.length);
      const rotateDeg = 360 * 10 + (360 - index * anglePer - anglePer / 2); // æ¯æ¬¡å¤šè½‰10åœˆ
      totalRotate += rotateDeg;
      wheel.style.transform = `rotate(${totalRotate}deg)`;

    

 

      setTimeout(() => {
        const selected = currentPlaces[index];
        resultDiv.textContent = `ğŸ¯ é¸æ“‡ï¼š${selected.name}`;
        detailDiv.innerHTML = `
          <p>â­ æ˜Ÿç­‰ï¼š${selected.rating}</p>
          <p>ğŸ“ åœ°å€ï¼š${selected.address}</p>
          <button onclick="openGoogleMapsReview('${selected.place_id}')">æŸ¥çœ‹è©•è«–</button>
        `;

        if (highlightMarker) highlightMarker.setMap(null);
        highlightMarker = new google.maps.Marker({
          position: selected.location,
          map,
          title: selected.name,
          icon: {
            url: "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
          }
        });
        map.panTo(selected.location);
      }, 5200);
    }
    function openGoogleMapsReview(placeId) {
      const url = `https://www.google.com/maps/place/?q=place_id:${placeId}`;
      window.open(url, "_blank");
      }
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCGA4A_DiEKvSqYVDceTyhSxBAewqbzv2I&libraries=places&callback=initMap" async defer></script>
</body>
</html>
